<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>JavaScript unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />            
  <link rel="stylesheet" href="../vendor/jsunittest/unittest.css" type="text/css" />    
  
  <script src="../vendor/prototype/prototype.js"     type="text/javascript"></script>        
  <script src="../vendor/jsunittest/jsunittest.js"   type="text/javascript"></script> 
  
  <script src="../vendor/jquery/jquery-1.3.2.min.js" type="text/javascript"></script> 
  <script type="text/javascript" charset="utf-8">
    jQuery.noConflict();
  </script>
  
  <script src="../lib/js_extensions/string.js"       type="text/javascript"></script> 
  <script src="../lib/js_extensions/number.js"       type="text/javascript"></script> 
  <script src="../lib/js_extensions/date.js"         type="text/javascript"></script>                                                                                       
  <script type="text/javascript" charset="utf-8">
    var relax = {     
      debug: false,
    	uiBinder: {},         	
    	logger: {
    	  debug: function(message){
    	    if (relax.debug){
    	      try {console.log(message)} catch(e){};
  	      }
    	  }
    	}
  	};             
  	relax.debug = true;
  </script>                                                                           
  <script src="../lib/relax_helpers.js"              type="text/javascript"></script>
                                                                                            
  <script src="../lib/model/base.js"  type="text/javascript"></script>     

</head>
<body>
  <div id="content">
    <div id="header">
      <h1>Controller unit tests</h1>
    </div>                                   
    <div id="testlog"> </div>
  </div>     
    
  
  <script type="text/javascript">
  // <![CDATA[ 
        
   new Test.Unit.Runner({
     setup: function() { with(this) {
     }},
       
     teardown: function() { with(this) {
     }},
     
     testSetPropertyFunctionName: function() { with(this) {
       var model = new relax.model.Base();
       assertEqual('setPero', model.setPropertyFunctionName('pero'));
       assertEqual('setPeroZdero', model.setPropertyFunctionName('peroZdero'));
     }},
                       
    testSettingProperty: function() { with(this) {
      var model = { 
          first: "Pero", 
          last: "Zdero", 
          fullName: function(){ return this.first + ' ' + this.last; },
          setFullName: function(full) { var p = full.split(' '); this.first = p[0]; this.last = p[1]; }
        };
      relax.model.Base.call(model);
      
      assertEqual('Pero', model.first);                   
      assertEqual('Pero', model.getProperty('first'));
      assertEqual('Zdero', model.last);                                
      assertEqual('Pero Zdero', model.fullName());
      assertEqual('Pero Zdero', model.getProperty('fullName'));
      model.setProperty('fullName', 'Igor Anic');
      assertEqual('Igor', model.first);
      assertEqual('Anic', model.last);                         
      assertEqual('Igor Anic', model.getProperty('fullName'));
            
    }},        
    
    testModelWithChildModels: function() { with(this) {
      var model = { 
        firstName: "Igor", 
        lastName: "Anic", 
        children: [
           {firstName: 'Nina', age: 8},
           {firstName: 'Zara', age: 6}
         ],                            
         onChildChanged: function() { this.sumChildrenAge = this.children.inject(0, function(sum, child){ return sum + parseInt(child.age); }) }
        };
      relax.model.Base.call(model);
                                                     

      assertEqual(model, model.children[0].__parent);  
      assertEqual(model, model.children[1].__parent);  
      
      assertEqual(14, model.children.inject(0, function(sum, child){ return sum + child.age; }));
      assertUndefined(model.sumChildrenAge);
      model.children[0].setProperty('age', 9);
      assertEqual(15, model.sumChildrenAge)
      
    }}

    
     
            

   }, {testLog: "testlog"});
  // ]]>
  </script> 
</body>
</html>