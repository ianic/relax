<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>JavaScript unit test file</title>
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />            
  <link rel="stylesheet" href="../vendor/jsunittest/unittest.css" type="text/css" />    
  
  <script src="../vendor/prototype/prototype.js"     type="text/javascript"></script>        
  <script src="../vendor/jsunittest/jsunittest.js"   type="text/javascript"></script> 
  
  <!-- <script src="../vendor/jquery/jquery-1.3.2.min.js" type="text/javascript"></script> 
  <script type="text/javascript" charset="utf-8">
    jQuery.noConflict();
  </script>    -->
  
  <script src="../lib/js_extensions/string.js"       type="text/javascript"></script> 
  <script src="../lib/js_extensions/number.js"       type="text/javascript"></script> 
  <script src="../lib/js_extensions/date.js"         type="text/javascript"></script>                                                                                       
  <script type="text/javascript" charset="utf-8">
    var relax = {     
      debug: false,
    	uiBinder: {},         	
    	logger: {
    	  debug: function(message){
    	    if (relax.debug){
    	      try {console.log(message)} catch(e){};
  	      }
    	  }
    	}
  	};             
  	relax.debug = true;
  </script>                                                                           
  <script src="../lib/relax_helpers.js"              type="text/javascript"></script>
                                                                                      
  <script src="../lib/model_base.js"                 type="text/javascript"></script>  
  <script src="../lib/ui_binder/base_binder.js"      type="text/javascript"></script> 
  <script src="../lib/ui_binder/string_binder.js"    type="text/javascript"></script> 
  <script src="../lib/ui_binder/integer_binder.js"   type="text/javascript"></script> 
  <script src="../lib/ui_binder/date_binder.js"      type="text/javascript"></script> 
  <script src="../lib/ui_binder/currency_binder.js"  type="text/javascript"></script>     
    
</head>
<body>

<div id="content">

  <div id="header">
    <h1>Binding unit tests</h1>
  </div>                                   
  <div id="testlog"> </div>
</div>
             
<br/>
<div>  
  first:       <input type="text" name="firstName" id="firstName">  
  last:        <input type="text" name="lastName"  id="lastName">
  full:        <span id="fullName" style="border: solid 1px"> </span>                                   
  company:     <input type="text" name="company"  id="company">  
  age:         <input type="text" name="age"  id="age">    
  salary:      <input type="text" name="salary"  id="salary">    
  dateOfBirth: <input type="text" name="dateOfBirth"  id="dateOfBirth">    
</div>


<script>

  var date1 = Date.fromJSON('1972-03-08T00:00:00Z');
  var date2 = Date.fromJSON('1972-08-08T00:00:00Z');

  function setElementValue(element, value){
    $(element).value = value;
    $(element).fire('test:change');  
    //jQuery('#' + $(element).id).change();  
  };
  
  function changePersonUi(){
    setElementValue('firstName', 'Pero');
    setElementValue('lastName',  'Peric');  
    setElementValue('company',   'minus6')
    setElementValue('age',       21);
    setElementValue('salary',    123456.78);
    setElementValue('dateOfBirth', '8.8.1972');
  };
  
</script>
<script type="text/javascript">
  // <![CDATA[
    new Test.Unit.Runner({        
                
    setup: function() { 
      if (!this.person){
        this.person = {
            firstName: "Igor", 
            lastName: "Anic", 
            fullName: function(){ return this.firstName + ' ' + this.lastName; },
            company: "minus5",
            age: 37,
            salary: 12345.67,
            dateOfBirth: date1
          };            
        relax.ModelBase.call(this.person);                                          
        
        this.firstNameBinder = new relax.uiBinder.BinderBase('firstName', this.person);
        this.lastNameBinder  = new relax.uiBinder.BinderBase('lastName',  this.person);                                               
        this.fullNameBinder  = new relax.uiBinder.BinderBase('fullName',  this.person);                
        this.companyBinder   = new relax.uiBinder.StringBinder('company', this.person);        
        this.ageBinder       = new relax.uiBinder.IntegerBinder('age',    this.person);
        this.salaryBinder    = new relax.uiBinder.CurrencyBinder('salary',this.person);                
        this.dateOfBirthBinder    = new relax.uiBinder.DateBinder('dateOfBirth',this.person); 
      }                                                             
      
      this.person.firstName = 'Igor';
      this.person.lastName  = 'Anic';            
      this.person.company   = 'minus5';            
      this.person.age       = 37;   
      this.person.salary    = 12345.67;        
      this.person.dateOfBirth = date1;
      this.person.changed();      
    },  
           
    teardown: function() {},
    
    testBinderBaseSimpleBinding: function() { with(this) {                          
      assertEqual('Igor', this.firstNameBinder.elementValue());
      assertEqual('Anic', this.lastNameBinder.elementValue());                                                                              
      changePersonUi();            
      assertEqual('Pero',this.person.firstName);
      assertEqual('Peric', this.person.lastName);                 
    }}, 
    
    testBinderBaseFunctionBinding: function() { with(this) {
      assertEqual('Igor Anic', this.person.fullName());
      assertEqual('Igor Anic', this.fullNameBinder.elementValue());
      changePersonUi();
      assertEqual('Pero Peric', this.person.fullName());
      assertEqual('Pero Peric', this.fullNameBinder.elementValue());       
    }},
    
    testStringBinder: function() {with(this){
      assertEqual('minus5', this.companyBinder.elementValue());
      changePersonUi();
      assertEqual('minus6', this.person.company);
    }},  
    
    testIntegerBinder: function() {with(this){
      assertEqual(37, this.ageBinder.elementValue());       
      assertEqual('number', relax.getType(this.ageBinder.elementValue()));
      changePersonUi();                                                   
      assertEqual('number', relax.getType(this.person.age));
      assertEqual(21, this.person.age);
    }},
    
    testCurrencyBinder: function() {with(this){
      assertEqual(12345.67, this.salaryBinder.elementValue());
      assertEqual($('salary').value, '12.345,67');             
      assertEqual('number', relax.getType(this.salaryBinder.elementValue()));
      changePersonUi(); 
      assertEqual('number', relax.getType(this.person.salary));
      assertEqual(123456.78, this.person.salary);
      assertEqual($('salary').value, '123.456,78');                    
      assertEqual('string', relax.getType($('salary').value));
    }},
    
    testDateBinder: function() {with(this){    
      assertEqual(date1.getTime(), this.dateOfBirthBinder.elementValue().getTime());
      assertEqual($('dateOfBirth').value, '8.3.1972');             
      assertEqual('Date', relax.getType(this.dateOfBirthBinder.elementValue()));
      changePersonUi(); 
      assertEqual('Date', relax.getType(this.person.dateOfBirth));
      assertEqual(date2.getTime(), this.person.dateOfBirth.getTime());
      assertEqual($('dateOfBirth').value, '8.8.1972');                    
      assertEqual('string', relax.getType($('dateOfBirth').value));
    }},
    
    testDateBinderDefaults: function() {with(this){    
      var today = new Date();                                    
      //ako upise samo datum, mjesec i godina su tekuci
      setElementValue('dateOfBirth', '15');                            
      assertEqual((new Date(today.getFullYear(), today.getMonth(), 15)).getTime() , this.person.dateOfBirth.getTime());
                                                  
      //ako upise dan i mjesec godina se podrazumjeva
      setElementValue('dateOfBirth', '15.2');                            
      assertEqual((new Date(today.getFullYear(), 1, 15)).getTime() , this.person.dateOfBirth.getTime());

      //nule i zarezi su ok
      setElementValue('dateOfBirth', '15.02.');                            
      assertEqual((new Date(today.getFullYear(), 1, 15)).getTime() , this.person.dateOfBirth.getTime());
      
      //15 dana od danas
      setElementValue('dateOfBirth', '+15');                            
      assertEqual((new Date(today.getFullYear(), today.getMonth(), today.getDate() + 15)).getTime() , this.person.dateOfBirth.getTime());                                                                                                        
      
      //prije 30 dana
      setElementValue('dateOfBirth', '-30');                            
      assertEqual((new Date(today.getFullYear(), today.getMonth(), today.getDate() - 30)).getTime() , this.person.dateOfBirth.getTime());                  
    }}
    
                       
    
  });  
  
// ]]>
</script> 
</body>
</html>